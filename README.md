# 原煤指标 - 客户端数据管理系统

一个纯前端的煤炭数据管理工具，支持数据录入、自动计算、本地存储和 CSV 导出。无需服务器，直接在浏览器中运行。

## ✨ 功能特性

- ✅ **数据录入**: 支持日期、文本和数值输入
- ✅ **自动计算**: 实时计算合计和平均值
- ✅ **输入验证**: 数值列自动验证，非法输入高亮提示
- ✅ **行操作**: 新增、批量删除行
- ✅ **本地持久化**: 数据自动保存到浏览器本地存储
- ✅ **CSV 导出**: 导出包含中文表头的 CSV 文件，Excel 可直接打开
- ✅ **响应式设计**: 支持桌面和移动设备，横向滚动查看所有列
- ✅ **离线可用**: 无需网络连接，纯客户端运行

## 📋 数据模型

### 列定义

| 列名 | 类型 | 说明 |
|------|------|------|
| 序号 | 数字 | 自动编号 1..N |
| 日期 | 日期 | YYYY-MM-DD 格式 |
| 单位 | 文本 | 自由输入 |
| 入库 | 数值 | 数字或小数 |
| 全灰 | 数值 | 数字或小数 |
| 内灰 | 数值 | 数字或小数 |
| 硫 | 数值 | 数字或小数 |
| 挥发 | 数值 | 数字或小数 |
| 粘结 | 数值 | 数字或小数 |
| 中煤 | 数值 | 数字或小数 |
| 矸石 | 数值 | 数字或小数 |

### 计算列（表尾显示）

- **内灰合计**: 所有行内灰的总和
- **挥发合计**: 所有行挥发的总和
- **粘结合计**: 所有行粘结的总和

### 统计行

- **合计行**: 显示所有数值列的总和（整数）
- **平均行**: 显示内灰、挥发、粘结的平均值（保留两位小数）

## 🚀 快速开始

### 方法 1: 直接打开（推荐）

1. 下载或克隆本项目
2. 找到 `index.html` 文件
3. 双击打开，或右键选择浏览器打开
4. 开始使用！

### 方法 2: 使用本地服务器（可选）

如果需要更好的开发体验：

```bash
# 使用 Python 3
python -m http.server 8000

# 或使用 Python 2
python -m SimpleHTTPServer 8000

# 或使用 Node.js (需要先安装 http-server)
npx http-server -p 8000
```

然后在浏览器中访问 `http://localhost:8000`

## 📖 使用说明

### 数据录入

1. **日期**: 点击日期单元格，使用浏览器的日期选择器
2. **文本**: 直接在单位列输入文字
3. **数值**: 在数值列输入数字，支持小数

### 行操作

- **新增一行**: 点击"新增一行"按钮，在表格末尾添加空行
- **删除行**: 
  1. 勾选要删除的行（可多选）
  2. 点击"删除选中"按钮
  3. 确认删除操作

### 数据管理

- **保存**: 点击"保存"按钮将数据保存到浏览器本地存储
- **导出 CSV**: 点击"导出 CSV"按钮下载 CSV 文件
- **重置**: 点击"重置"按钮清空所有数据并恢复初始 6 行模板

### 自动计算

- 输入或修改任何数值后，合计和平均值会自动更新
- 空值或非法输入视为 0 参与计算
- 平均值只计算有效数值（排除空值）

## 📁 项目结构

```
原煤指标/
├── index.html          # 主页面
├── styles.css          # 样式文件
├── app.js              # 主应用逻辑
├── utils/
│   ├── math.js         # 数学计算工具
│   └── csv.js          # CSV 导出工具
└── README.md           # 本文件
```

## 🔧 技术栈

- **HTML5**: 语义化标签、表单控件
- **CSS3**: Flexbox、响应式设计、动画
- **JavaScript (ES6+)**: 原生 JavaScript，无框架依赖
- **Web APIs**: 
  - LocalStorage (数据持久化)
  - Blob API (文件生成)
  - URL.createObjectURL (文件下载)

## ⚠️ 常见问题

### Q1: 为什么刷新页面后数据丢失？

**A**: 请确保在修改数据后点击"保存"按钮。数据保存在浏览器的 LocalStorage 中，只有手动保存才会持久化。

### Q2: CSV 文件在 Excel 中显示乱码

**A**: 本应用已添加 UTF-8 BOM，正常情况下 Excel 应该能正确识别中文。如果仍有问题：
- 尝试使用 Excel 的"数据" → "从文本/CSV"导入功能
- 选择 UTF-8 编码
- 或使用 WPS、Google Sheets 等其他工具打开

### Q3: 无法导出 CSV 文件

**A**: 
- 确保浏览器允许下载文件（检查浏览器设置）
- 某些浏览器可能会拦截自动下载，请允许弹出窗口
- 尝试使用 Chrome、Firefox 或 Edge 等现代浏览器

### Q4: 输入数字后显示红色边框

**A**: 这表示输入了非法字符。数值列只接受数字和小数点，请检查输入内容。

### Q5: 清除浏览器缓存后数据丢失

**A**: LocalStorage 数据会随着浏览器缓存清除而丢失。建议：
- 定期使用"导出 CSV"功能备份数据
- 或在清除缓存前先导出数据

### Q6: 在手机上使用体验不佳

**A**: 
- 表格支持横向滚动，可以左右滑动查看所有列
- 建议横屏使用以获得更好的体验
- 数值输入会自动调用数字键盘

### Q7: 平均值显示 0.00

**A**: 这是正常的，表示该列没有有效数值。只有输入了有效数字的行才会参与平均值计算。

## 🔒 数据安全

- **本地存储**: 所有数据仅保存在您的浏览器中，不会上传到任何服务器
- **隐私保护**: 无网络请求，无数据收集，完全离线运行
- **数据备份**: 建议定期导出 CSV 文件作为备份

## 🌐 浏览器兼容性

支持所有现代浏览器：

- ✅ Chrome 60+
- ✅ Firefox 60+
- ✅ Safari 12+
- ✅ Edge 79+
- ✅ Opera 50+

**注意**: 不支持 IE 浏览器

## 📝 数据验证规则

1. **数值列**: 只接受数字、小数点和负号
2. **空值处理**: 空值在计算时视为 0
3. **非法输入**: 显示红色边框并弹出提示
4. **实时验证**: 输入时即时验证，不影响其他列计算

## 🎨 自定义

### 修改初始行数

编辑 `app.js` 中的 `initEmptyRows()` 函数：

```javascript
function initEmptyRows() {
  state.rows = [];
  for (let i = 1; i <= 10; i++) {  // 改为 10 行
    state.rows.push(createEmptyRow(i));
  }
}
```

### 修改颜色主题

编辑 `styles.css` 中的颜色变量：

```css
.btn-primary {
  background-color: #your-color;  /* 修改按钮颜色 */
}

.total-row {
  background-color: #your-color !important;  /* 修改合计行颜色 */
}
```

### 修改存储键名

编辑 `app.js` 中的 `state.storageKey`：

```javascript
const state = {
  rows: [],
  storageKey: 'your_custom_key'  // 修改存储键名
};
```

## 🐛 故障排除

### 问题: 页面无法加载

**解决方案**:
1. 检查所有文件是否在同一目录下
2. 确保 `utils/` 文件夹包含 `math.js` 和 `csv.js`
3. 打开浏览器开发者工具（F12）查看控制台错误

### 问题: 计算结果不正确

**解决方案**:
1. 检查输入的数值是否有非法字符
2. 确保没有输入框显示红色边框
3. 尝试刷新页面重新计算

### 问题: 无法保存数据

**解决方案**:
1. 检查浏览器是否启用了 LocalStorage
2. 某些隐私模式可能禁用本地存储
3. 检查浏览器存储空间是否已满

## 📄 许可证

MIT License - 可自由使用、修改和分发

## 🤝 贡献

欢迎提交问题和改进建议！

## 📞 技术支持

如遇到问题，请：
1. 查看本 README 的常见问题部分
2. 检查浏览器控制台的错误信息
3. 确保使用的是现代浏览器的最新版本

---

**提示**: 首次使用时，页面会显示 6 行空模板。输入数据后记得点击"保存"按钮！
